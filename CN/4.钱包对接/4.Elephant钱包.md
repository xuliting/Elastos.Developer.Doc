# Elephant钱包对接协议

版本：1.1

## 介绍

为了让第三方应用简单方便地接入区块链，拥有使用区块链的能力，Elephant钱包开放接口给第三方应用，让第三方应用可以通过Elephant完成支付数字币、使用DID身份、向区块链写入数据。

第三方可以通过特殊的Scheme “Elaphant”来唤起和调用Elephant，也可以将调用的URI编码成二维码，让Elephant主动扫描二维码来执行相应操作。

目前可选的指令包括Identity、Elapay、Eladposvote、Sign、Property。

## 指令

### Identity指令

当第三方应用程序需要用户的个人DID身份时，它可以向Elephant 应用发起请求，并且用户将通过Elephant应用程序进行身份验证并被授权将某些信息返回给第三方。
一个典型的用例是登录：

- 步骤1：第三方生成请求内容，包括请求者信息和随机数。
- 步骤2：用户获得授权后，签名随机数和DID信息，并将发送一个回调给第三方。
- 步骤3：第三方验证返回信息。 Elephant 应用将跳转到第三方指定的返回页面。

### Elapay指令

当第三方应用程序需要使用加密令牌付款时，它可以向大象应用程序发起请求，并且用户可以授权大象应用程序代表他们进行支付，类似于 支付宝 和 Paypal。

- 步骤1：第三方发起请求，包括付款内容，金额，货币和订单唯一标识符。
- 步骤2：Elephant app从转账支付页面开始，不久之后，用户被授权并启动转账并将txid返回给第三方。
- 步骤3：第三方向节点接口查询具有txid的交易状态。

## 调用规范

### 1. Identity指令

#### 步骤1, Request

参数：

字段名称           | 类型              | 描述
----------------------| ------------------- | -------------------
AppName                 | String     | 你的应用名称; 长度不超过64个字节
AppID                   | String     | 你的app id; 长度不超过64字节，base58编码，并且在开发人员的DID中是唯一的。
Description             | String     | 对于App和当前操作的描述，方便用户判断是否授权
RandomNumber            | Number     | 用于获得用户签名的随机数
DID                     | String     | 开发人员的DID
PublicKey               | String     | DID的公钥
Signature               | String     | AppID的签名
RequestInfo*            | String     | 请求的DID信息
CallbackUrl             | String     | 请求结果的回调URI
ReturnUrl               | String     | 回调后返回的页面URI

* RequestInfo字段是第三方需要的信息字段，以逗号分隔，字段名称与下面response中定义的字段名称相同。

通过scheme调用请求的示例：
```
elaphant://identity?CallbackUrl=http://localhost:8081/packet/grab/1509893100600982-0&Description=red&AppID=cc053c61afc22dda9a309e96943c1734&SerialNumber=368F42311054A0B1FF35EF08F274E917417132734461A84F0D48C8864E356D26&PublicKey=028971D6DA990971ABF7E8338FA1A81E1342D0E0FD8C4D2A4DF68F776CA66EA0B1&Signature=90E8A60DC055C90F4765E91B6E4F07031F55CF7DD2DA4EF1EF55EA41D160CB48879F62D70EC8ED090E4CBBE013D21E7580C36CFA2173A997ADADB7255B23098F&Amount=0.011200&PaymentAddress=EdBndwMd3WsgqKRoZMPyAG5r9jMw4wJrTK&DID=ihKwfxiFpYme8mb11roShjjpZcHt1Ru5VB&CoinName=ELA&AppName=red&RequestInfo=BTCAddress,ETHAddress,Email,PhoneNumber,RandomNumber
```

通过QR码请求的示例：

![image](../../Ignore/images/qrcode.png)

#### 步骤2, Response

参数：

字段名称           | 类型             | 描述
-------------------------- | ------------------ | -------------------
DID             | String    | 用户的DID
PublicKey       | String    | DID的公钥
Nickname        | String    | 用户的昵称
ELAAddress      | String    | 用户的ELA钱包地址
BTCAddress      | String    | 用户的BTC钱包地址
BCHAddress      | String    | 用户的BCH钱包地址
ETHAddress      | String    | 用户的ETH钱包地址
IOEXAddress     | String    | 用户的IOEX钱包地址
Email           | String    | 用户的电子邮件
PhoneNumber     | String    | 用户的电话号码
ChineseIDCard   | String    | 用户的中国身份证。内容是json格式
RandomNumber    | String    | 第三方请求的随机数
Signature       | String    | 签名内容

Http回调示例：
```
Method: POST
URL: https://redpacket.elastos.org/packet/grab/3176517663416268-1?_locale=zh_CN&offset=-480
Body:
{
  "Data": "{"BTCAddress":"1Fmb9MLJ74ShWG5WcJWqMTDBfPTJPnQzVP","DID":"iYarsyzWeaSRa7XVqeCeNpa1J9sGB4Uwyr","ELAAddress":"EHeSKgaFNxPJiLScvase437D2pM9isw4pX","EMail":"","ETHAddress":"0x6601F031E63cb2C477beE183D671F0517a37CdC7","NickName":"中文测试","PhoneNumber":"","PublicKey":"03b27a7ae64d9f11c9685475f76d9e3ba6498953c49f69962b6566655146820d71"}",
  "PublicKey": "03b27a7ae64d9f11c9685475f76d9e3ba6498953c49f69962b6566655146820d71",
  "Sign": "02e1df21bc11744421ece9be874691ebace8f6ce7ea4443d0f96500e9a9db3978ce90eecc9863be8de27648eb316560df904eaf1c6fc2dc8bf630822cdb9c176"
}
```

#### 步骤3, Verify & Return

### 2. Elapay指令

#### 步骤1, Request

参数：

字段名称           | 类型              | 描述
----------------------| ------------------- | -------------------
AppName                 | String     | 你的应用名称; 长度不超过64个字节
AppID                   | String     | 你的app id; 长度不超过64字节，base58编码，并且在开发人员的DID中是唯一的。
Description             | String     | 对于App和当前操作的描述，方便用户判断是否授权
DID                     | String     | 开发人员的DID
PublicKey               | String     | DID的公钥
Signature               | String     | AppID的签名
CoinName                | String     | 加密令牌的名称
Amount                  | Number     | 要支付的金额（即多少令牌？）
PaymentAddress          | String     | 用于付款的地址
CallbackUrl             | String     | 请求结果的回调URI
ReturnUrl               | String     | 回调后返回的页面URI

#### 步骤2, Response

参数:

字段名称            | 类型              | 描述
-------------------------- | ------------------ | -------------------
TXID                | String    | Transaction ID.

Http回调示例:
```
Method: POST
URL: https://redpacket.elastos.org/packet/grab/3176517663416268-1?_locale=zh_CN&offset=-480
Body:
{
  "Txid": "895630890fa53437cdd09e1f3bb4934585e1914eb45eb3a6b1e4a4d6bd789718",
}
```

您可以通 `blockchain.elastos.org` 确认交易状态.

例如:

<https://blockchain.elastos.org/tx/895630890fa53437cdd09e1f3bb4934585e1914eb45eb3a6b1e4a4d6bd789718>

#### 步骤3, Verify & Return

